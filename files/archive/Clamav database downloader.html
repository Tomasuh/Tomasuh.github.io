<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Clamav database downloader | TomsonSec</title>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok2v=1613a3a185/"},atok:"c2f92801b93be329f53894911606aec8",petok:"dcb12b2564df0a365d564f2c36422442942b2409-1419606325-1800",zone:"tomsonsec.com",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok2v=919620257c/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script><script type="text/javascript" src="Clamav%20database%20downloader%20%7C%20TomsonSec_files/cloudflare.js"></script><style type="text/css">.cf-hidden { display: none; } .cf-invisible { visibility: hidden; }</style><script data-module="cloudflare/rocket" id="cfjs_block_62ad2e8337" onload="CloudFlare.__cfjs_block_62ad2e8337_load()" onerror="CloudFlare.__cfjs_block_62ad2e8337_error()" onreadystatechange="CloudFlare.__cfjs_block_62ad2e8337_readystatechange()" type="text/javascript" src="Clamav%20database%20downloader%20%7C%20TomsonSec_files/rocket.js"></script>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://tomsonsec.com/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://tomsonsec.com/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="TomsonSec » Feed" href="http://tomsonsec.com/index.php/feed/">
<link rel="alternate" type="application/rss+xml" title="TomsonSec » Comments Feed" href="http://tomsonsec.com/index.php/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="TomsonSec » Clamav database downloader Comments Feed" href="http://tomsonsec.com/index.php/clamav-database-downloader/feed/">
<link rel="stylesheet" id="twentytwelve-fonts-css" href="Clamav%20database%20downloader%20%7C%20TomsonSec_files/css.css" type="text/css" media="all">
<link rel="stylesheet" id="twentytwelve-style-css" href="Clamav%20database%20downloader%20%7C%20TomsonSec_files/A.css" type="text/css" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://tomsonsec.com/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script data-rocketoptimized="true" type="text/rocketscript" data-rocketsrc="http://tomsonsec.com/wp-includes/js/jquery/jquery.js,qver=1.11.1.pagespeed.jm.z9hb-Gxqf6.js"></script>
<script data-rocketoptimized="true" type="text/rocketscript" data-rocketsrc="http://tomsonsec.com/wp-includes/js/jquery/jquery-migrate.min.js,qver=1.2.1.pagespeed.jm.mhpNjdU8Wl.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://tomsonsec.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://tomsonsec.com/wp-includes/wlwmanifest.xml">
<link rel="next" title="Concept anti-virus in python" href="http://tomsonsec.com/index.php/concept-anti-virus-in-python/">
<meta name="generator" content="WordPress 4.1">
<link rel="canonical" href="http://tomsonsec.com/index.php/clamav-database-downloader/">
<link rel="shortlink" href="http://tomsonsec.com/?p=38">
 
<script data-rocketoptimized="true" type="text/rocketscript" data-rocketsrc="http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shCore.js.pagespeed.jm.ErSeI76fhQ.js"></script>
<script data-rocketoptimized="true" type="text/rocketscript">//<![CDATA[
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('(2(){1 h=5;h.I=2(){2 n(c,a){4(1 d=0;d<c.9;d++)i[c[d]]=a}2 o(c){1 a=r.H("J"),d=3;a.K=c;a.M="L/t";a.G="t";a.u=a.v=2(){6(!d&&(!8.7||8.7=="F"||8.7=="z")){d=q;e[c]=q;a:{4(1 p y e)6(e[p]==3)B a;j&&5.C(k)}a.u=a.v=x;a.D.O(a)}};r.N.R(a)}1 f=Q,l=h.P(),i={},e={},j=3,k=x,b;5.T=2(c){k=c;j=q};4(b=0;b<f.9;b++){1 m=f[b].w?f[b]:f[b].S(/\\s+/),g=m.w();n(m,g)}4(b=0;b<l.9;b++)6(g=i[l[b].E.A]){e[g]=3;o(g)}}})();',56,56,'|var|function|false|for|SyntaxHighlighter|if|readyState|this|length|||||||||||||||||true|document||javascript|onload|onreadystatechange|pop|null|in|complete|brush|break|highlight|parentNode|params|loaded|language|createElement|autoloader|script|src|text|type|body|removeChild|findElements|arguments|appendChild|split|all'.split('|'),0,{}))
//]]></script>
<link type="text/css" rel="stylesheet" href="Clamav%20database%20downloader%20%7C%20TomsonSec_files/A_002.css">
 
<style type="text/css" id="custom-background-css">body.custom-background{background-color:#fff;background-image:url(http://tomsonsec.com/wp-content/uploads/2013/11/tweed_,402X.png.pagespeed.ce.ovGQxspg7h.png);background-repeat:repeat;background-position:top left;background-attachment:fixed}</style>
</head>
<body class="single single-post postid-38 single-format-standard custom-background full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
<header id="masthead" class="site-header" role="banner">
<hgroup>
<h1 class="site-title"><a href="http://tomsonsec.com/" title="TomsonSec" rel="home">TomsonSec</a></h1>
<h2 class="site-description">Computer security and more</h2>
</hgroup>
<nav id="site-navigation" class="main-navigation" role="navigation">
<h3 class="menu-toggle">Menu</h3>
<a class="assistive-text" href="#content" title="Skip to content">Skip to content</a>
<div class="nav-menu"><ul><li><a href="http://tomsonsec.com/">Home</a></li><li class="page_item page-item-54"><a href="http://tomsonsec.com/index.php/54-2/">About</a></li><li class="page_item page-item-377"><a href="http://tomsonsec.com/index.php/practical-reverse-engineering/">Practical Reverse Engineering – solutions</a></li></ul></div>
</nav> 
</header> 
<div id="main" class="wrapper">
<div id="primary" class="site-content">
<div id="content" role="main">
<article id="post-38" class="post-38 post type-post status-publish format-standard hentry category-clamav category-programming tag-clamav tag-database-download tag-python tag-security">
<header class="entry-header">
<h1 class="entry-title">Clamav database downloader</h1>
<div class="comments-link">
<a href="http://tomsonsec.com/index.php/clamav-database-downloader/#respond" title="Comment on Clamav database downloader"><span class="leave-reply">Leave a reply</span></a> </div> 
</header> 
<div class="entry-content">
<p>I’ve been writing a simple AV in python and used the Clamav signature
 database ( one of few av databases you can come by ). Though it is a 
bit of a hack grabbing it as you need to remove the first 512 bytes from
 the file as thats the Clamav signature.</p>
<p>With it removed it’s just a simple .tar.gz file!</p>
<p>I’ve made a python script with support for both download the whole database and update it.<br>
Though it may look a bit messy it works flawlessy, if you use it correct <img src="data:image/gif;base64,R0lGODlhDwAPAPMAAP/qAEVFRQAAAP/OAP/JAP6dAP+0AP/+k//9E///x//lAP//6wAAAAAAAAAAAAAAACH5BAEAAAwALAAAAAAPAA8AQARVkEkZap0Ugc23AIQRMMHxddwwUsNAvO9QrNSSINomr2V+dqFRYAD4FUEqDMVCU1Zsh4OqGUiYUIAd6ebhCD6EWQkLFA3JRUVY2FJ8v2rtpGKoG8STCAA7" alt=";)" class="wp-smiley"> Give a comment with error messages if it fails.</p>
<div><div id="highlighter_431411" class="syntaxhighlighter  py"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div><div class="line number108 index107 alt1">108</div><div class="line number109 index108 alt2">109</div><div class="line number110 index109 alt1">110</div><div class="line number111 index110 alt2">111</div><div class="line number112 index111 alt1">112</div><div class="line number113 index112 alt2">113</div><div class="line number114 index113 alt1">114</div><div class="line number115 index114 alt2">115</div><div class="line number116 index115 alt1">116</div><div class="line number117 index116 alt2">117</div><div class="line number118 index117 alt1">118</div><div class="line number119 index118 alt2">119</div><div class="line number120 index119 alt1">120</div><div class="line number121 index120 alt2">121</div><div class="line number122 index121 alt1">122</div><div class="line number123 index122 alt2">123</div><div class="line number124 index123 alt1">124</div><div class="line number125 index124 alt2">125</div><div class="line number126 index125 alt1">126</div><div class="line number127 index126 alt2">127</div><div class="line number128 index127 alt1">128</div><div class="line number129 index128 alt2">129</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py comments">#Clamav database fetcher and unpacker.</code></div><div class="line number2 index1 alt1"><code class="py comments">#Made by Tomasuh/Axel Olsson at tomsonsec.com</code></div><div class="line number3 index2 alt2"><code class="py comments">#For contact: tomasuh [at] tomsonsec.com</code></div><div class="line number4 index3 alt1"><code class="py keyword">import</code> <code class="py plain">sys,tarfile,os,shutil,stat,urllib2,random</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="py keyword">class</code> <code class="py plain">ClamAvDatabase(</code><code class="py functions">object</code><code class="py plain">):</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">wantedFiles </code><code class="py keyword">=</code> <code class="py plain">[</code><code class="py string">"main.db"</code><code class="py plain">,</code><code class="py string">"main.fp"</code><code class="py plain">,</code><code class="py string">"main.hdb"</code><code class="py plain">,</code><code class="py string">"main.info"</code><code class="py plain">,</code><code class="py string">"main.mdb"</code><code class="py plain">,</code><code class="py string">"main.ndb"</code><code class="py plain">,</code><code class="py string">"main.zmd"</code><code class="py plain">]</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">__init__(</code><code class="py color1">self</code><code class="py plain">):</code></div><div class="line number11 index10 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py functions">len</code> <code class="py plain">(sys.argv) !</code><code class="py keyword">=</code> <code class="py value">2</code><code class="py plain">:</code></div><div class="line number12 index11 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code> <code class="py string">"Usage:"</code> <code class="py keyword">+</code> <code class="py plain">sys.argv[</code><code class="py value">0</code><code class="py plain">] </code><code class="py keyword">+</code> <code class="py string">" maindb/update"</code></div><div class="line number13 index12 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.exit()</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">sys.argv[</code><code class="py value">1</code><code class="py plain">]</code><code class="py keyword">=</code><code class="py keyword">=</code><code class="py string">"maindb"</code><code class="py plain">:</code></div><div class="line number16 index15 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.dlDatabase(</code><code class="py string">"<a href="http://db.local.clamav.net/main.cvd">http://db.local.clamav.net/main.cvd</a>"</code><code class="py plain">)</code></div><div class="line number17 index16 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.cleanup()</code></div><div class="line number18 index17 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.removeHeader()</code></div><div class="line number19 index18 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.extractFiles(</code><code class="py string">"clamavDB"</code><code class="py plain">)</code></div><div class="line number20 index19 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">elif</code> <code class="py plain">sys.argv[</code><code class="py value">1</code><code class="py plain">]</code><code class="py keyword">=</code><code class="py keyword">=</code><code class="py string">"update"</code><code class="py plain">:</code></div><div class="line number21 index20 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.dlDatabase(</code><code class="py string">"<a href="http://db.local.clamav.net/daily.cvd">http://db.local.clamav.net/daily.cvd</a>"</code><code class="py plain">)</code></div><div class="line number22 index21 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">directoryName </code><code class="py keyword">=</code> <code class="py color1">self</code><code class="py plain">.tempPath()</code></div><div class="line number23 index22 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.removeHeader()</code></div><div class="line number24 index23 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.extractFiles(directoryName)</code></div><div class="line number25 index24 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.updateFiles(directoryName,</code><code class="py string">"clamavDB/"</code><code class="py plain">)</code></div><div class="line number26 index25 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.rmPath(directoryName)</code></div><div class="line number27 index26 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.exit()</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#Downloads specified url and saves to test.cv</code></div><div class="line number30 index29 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">dlDatabase(</code><code class="py color1">self</code><code class="py plain">,url):</code></div><div class="line number31 index30 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable("</code><code class="py string">","</code><code class="py plain">test.cvd")</code></div><div class="line number32 index31 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">dl </code><code class="py keyword">=</code> <code class="py plain">urllib2.urlopen(url)</code></div><div class="line number33 index32 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">meta </code><code class="py keyword">=</code> <code class="py plain">dl.info()</code></div><div class="line number34 index33 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">fileSize </code><code class="py keyword">=</code> <code class="py functions">int</code><code class="py plain">(meta.getheaders(</code><code class="py string">"Content-Length"</code><code class="py plain">)[</code><code class="py value">0</code><code class="py plain">])</code></div><div class="line number35 index34 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">fileDataSave</code><code class="py keyword">=</code><code class="py plain">""</code></div><div class="line number36 index35 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code> <code class="py string">"Downloading database, this might take a minute or two."</code></div><div class="line number37 index36 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#I know this aint memory sufficent for shit, but hey, I hope you can spare 60 MB of RAM.</code></div><div class="line number38 index37 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">while</code> <code class="py color1">True</code><code class="py plain">:</code></div><div class="line number39 index38 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">fileData </code><code class="py keyword">=</code> <code class="py plain">dl.read(</code><code class="py value">8024</code><code class="py plain">)</code></div><div class="line number40 index39 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py keyword">not</code> <code class="py plain">fileData:</code></div><div class="line number41 index40 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">break</code></div><div class="line number42 index41 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">fileDataSave</code><code class="py keyword">+</code><code class="py keyword">=</code><code class="py plain">fileData</code></div><div class="line number43 index42 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">progress </code><code class="py keyword">=</code> <code class="py plain">((</code><code class="py functions">len</code><code class="py plain">(fileDataSave)</code><code class="py keyword">*</code><code class="py value">10</code><code class="py keyword">/</code><code class="py plain">fileSize))</code></div><div class="line number44 index43 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.stdout.write (</code><code class="py string">"\r"</code><code class="py keyword">+</code><code class="py string">"["</code><code class="py keyword">+</code><code class="py string">"*"</code> <code class="py keyword">*</code> <code class="py plain">progress </code><code class="py keyword">+</code> <code class="py string">" "</code> <code class="py keyword">*</code> <code class="py plain">(</code><code class="py value">10</code> <code class="py keyword">-</code> <code class="py plain">progress)</code><code class="py keyword">+</code> <code class="py string">"]"</code><code class="py plain">)</code></div><div class="line number45 index44 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.stdout.flush()</code></div><div class="line number46 index45 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code> <code class="py string">"\n"</code></div><div class="line number47 index46 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">with </code><code class="py functions">open</code><code class="py plain">(</code><code class="py string">"test.cvd"</code><code class="py plain">,</code><code class="py string">"wb"</code><code class="py plain">) as f:</code></div><div class="line number48 index47 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">f.write(fileDataSave)</code></div><div class="line number49 index48 alt2">&nbsp;</div><div class="line number50 index49 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#Makes file writable if not.</code></div><div class="line number51 index50 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">makeWritable(</code><code class="py color1">self</code><code class="py plain">,directory,fileN):</code></div><div class="line number52 index51 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">os.path.isfile(directory</code><code class="py keyword">+</code><code class="py plain">fileN):</code></div><div class="line number53 index52 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code><code class="py plain">(</code><code class="py keyword">not</code> <code class="py plain">os.access(directory</code><code class="py keyword">+</code><code class="py plain">fileN,os.W_OK)):</code></div><div class="line number54 index53 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">os.chmod(directory</code><code class="py keyword">+</code><code class="py plain">fileN, stat.S_IWRITE)</code></div><div class="line number55 index54 alt2">&nbsp;</div><div class="line number56 index55 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#Cleanup from last download</code></div><div class="line number57 index56 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">cleanup(</code><code class="py color1">self</code><code class="py plain">):</code></div><div class="line number58 index57 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">os.access(</code><code class="py string">"clamavDB"</code><code class="py plain">, os.F_OK):</code></div><div class="line number59 index58 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">answ </code><code class="py keyword">=</code> <code class="py functions">raw_input</code><code class="py plain">(</code><code class="py string">"Directory clamavDB already exists, remove previous db files to avoid collisions? yes/no/abort\n"</code><code class="py plain">)</code></div><div class="line number60 index59 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">answ</code><code class="py keyword">=</code><code class="py keyword">=</code><code class="py string">"yes"</code><code class="py plain">:</code></div><div class="line number61 index60 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#Would be so more neat with just a rmtree for</code></div><div class="line number62 index61 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#the whole clamavDB and recreate the directory,</code></div><div class="line number63 index62 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#but wth, I want this to look good (and keep unassociated files)</code></div><div class="line number64 index63 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable(</code><code class="py string">"clamavDB"</code><code class="py plain">,"")</code></div><div class="line number65 index64 alt2">&nbsp;</div><div class="line number66 index65 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">for</code> <code class="py plain">fileOrDirectory </code><code class="py keyword">in</code> <code class="py plain">os.listdir(</code><code class="py string">"clamavDB"</code><code class="py plain">):</code></div><div class="line number67 index66 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#We only need to remove the ones we are gonna replace.</code></div><div class="line number68 index67 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">fileOrDirectory </code><code class="py keyword">in</code> <code class="py color1">self</code><code class="py plain">.wantedFiles: </code></div><div class="line number69 index68 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable(</code><code class="py string">"clamavDB/"</code><code class="py plain">, fileOrDirectory)</code></div><div class="line number70 index69 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">os.path.isdir(</code><code class="py string">"clamavDB/"</code><code class="py keyword">+</code><code class="py plain">fileOrDirectory):</code></div><div class="line number71 index70 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">shutil.rmtree(</code><code class="py string">"clamavDB/"</code><code class="py keyword">+</code><code class="py plain">fileOrDirectory,</code><code class="py color1">True</code><code class="py plain">)</code></div><div class="line number72 index71 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">else</code><code class="py plain">:</code></div><div class="line number73 index72 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">os.remove(</code><code class="py string">"clamavDB/"</code><code class="py keyword">+</code><code class="py plain">fileOrDirectory)</code></div><div class="line number74 index73 alt1">&nbsp;</div><div class="line number75 index74 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">elif</code> <code class="py plain">answ</code><code class="py keyword">=</code><code class="py keyword">=</code><code class="py string">"no"</code><code class="py plain">:</code></div><div class="line number76 index75 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code> <code class="py string">"Your fault if anything goes wrong but lets do this!"</code></div><div class="line number77 index76 alt2">&nbsp;</div><div class="line number78 index77 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">else</code><code class="py plain">:</code></div><div class="line number79 index78 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py functions">print</code> <code class="py string">"Aborting"</code></div><div class="line number80 index79 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">sys.exit()</code></div><div class="line number81 index80 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">else</code><code class="py plain">:</code></div><div class="line number82 index81 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">os.mkdir(</code><code class="py string">"clamavDB"</code><code class="py plain">)</code></div><div class="line number83 index82 alt2">&nbsp;</div><div class="line number84 index83 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#Extracts the tar.gz</code></div><div class="line number85 index84 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">extractFiles(</code><code class="py color1">self</code><code class="py plain">,directory):</code></div><div class="line number86 index85 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">extract </code><code class="py keyword">=</code> <code class="py plain">tarfile.</code><code class="py functions">open</code><code class="py plain">(</code><code class="py string">"test.cvd"</code><code class="py plain">, </code><code class="py string">"r:gz"</code><code class="py plain">)</code></div><div class="line number87 index86 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">try</code><code class="py plain">:</code></div><div class="line number88 index87 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">for</code> <code class="py plain">files </code><code class="py keyword">in</code> <code class="py color1">self</code><code class="py plain">.wantedFiles:</code></div><div class="line number89 index88 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">extract.extract(files,directory)</code></div><div class="line number90 index89 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">except</code><code class="py plain">: </code><code class="py comments"># add exact exception</code></div><div class="line number91 index90 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">extract.extractall(directory)</code></div><div class="line number92 index91 alt1">&nbsp;</div><div class="line number93 index92 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">extract.close()</code></div><div class="line number94 index93 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable("</code><code class="py string">","</code><code class="py plain">test.cvd")</code></div><div class="line number95 index94 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">os.remove(</code><code class="py string">"test.cvd"</code><code class="py plain">)</code></div><div class="line number96 index95 alt1">&nbsp;</div><div class="line number97 index96 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#r+b mode dosn't seem to work with binary files, weird.</code></div><div class="line number98 index97 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">removeHeader (</code><code class="py color1">self</code><code class="py plain">):</code></div><div class="line number99 index98 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">with </code><code class="py functions">open</code><code class="py plain">(</code><code class="py string">"test.cvd"</code><code class="py plain">,</code><code class="py string">"rb"</code><code class="py plain">) as f1:</code></div><div class="line number100 index99 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">data </code><code class="py keyword">=</code> <code class="py plain">f1.read()[</code><code class="py value">512</code><code class="py plain">:]</code></div><div class="line number101 index100 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">with </code><code class="py functions">open</code><code class="py plain">(</code><code class="py string">"test.cvd"</code><code class="py plain">, </code><code class="py string">"wb"</code><code class="py plain">) as f2:</code></div><div class="line number102 index101 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">f2.write(data)</code></div><div class="line number103 index102 alt2">&nbsp;</div><div class="line number104 index103 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#Fetches the update files with the correct file extension and appends them to the corresponding in the clamavDB directory.</code></div><div class="line number105 index104 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#(Observe that the only files who will be updated is the ones in wanted files)</code></div><div class="line number106 index105 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">updateFiles(</code><code class="py color1">self</code><code class="py plain">,inputDirectory,outputDirectory):</code></div><div class="line number107 index106 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">for</code> <code class="py plain">files </code><code class="py keyword">in</code> <code class="py color1">self</code><code class="py plain">.wantedFiles:</code></div><div class="line number108 index107 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">fileExtension </code><code class="py keyword">=</code> <code class="py plain">files.find(</code><code class="py string">"."</code><code class="py plain">)</code></div><div class="line number109 index108 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable(inputDirectory,</code><code class="py string">"daily"</code><code class="py keyword">+</code><code class="py plain">files[fileExtension:])</code></div><div class="line number110 index109 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable(outputDirectory,files)</code></div><div class="line number111 index110 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">with </code><code class="py functions">open</code><code class="py plain">(inputDirectory</code><code class="py keyword">+</code><code class="py string">"daily"</code><code class="py keyword">+</code><code class="py plain">files[fileExtension:],</code><code class="py string">"r"</code><code class="py plain">) as f:</code></div><div class="line number112 index111 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">with </code><code class="py functions">open</code><code class="py plain">(outputDirectory</code><code class="py keyword">+</code><code class="py plain">files,</code><code class="py string">"a"</code><code class="py plain">) as f2:</code></div><div class="line number113 index112 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">f2.write(f.read())</code></div><div class="line number114 index113 alt1">&nbsp;</div><div class="line number115 index114 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#A temporary path for storing the update files for a short time.</code></div><div class="line number116 index115 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">tempPath(</code><code class="py color1">self</code><code class="py plain">):</code></div><div class="line number117 index116 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">directoryName </code><code class="py keyword">=</code> <code class="py functions">str</code><code class="py plain">(random.randint(</code><code class="py value">10000</code><code class="py plain">,</code><code class="py value">9999999</code><code class="py plain">))</code></div><div class="line number118 index117 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#print directoryName</code></div><div class="line number119 index118 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">os.mkdir(directoryName)</code></div><div class="line number120 index119 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py functions">str</code> <code class="py plain">(directoryName</code><code class="py keyword">+</code><code class="py string">"/"</code><code class="py plain">)</code></div><div class="line number121 index120 alt2">&nbsp;</div><div class="line number122 index121 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments">#First we need to make the stuff inside the folder writable, after the folder itself, then we can remove it.</code></div><div class="line number123 index122 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">def</code> <code class="py plain">rmPath(</code><code class="py color1">self</code><code class="py plain">,directory):</code></div><div class="line number124 index123 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">for</code> <code class="py plain">files </code><code class="py keyword">in</code> <code class="py plain">os.listdir(directory):</code></div><div class="line number125 index124 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable(directory, files)</code></div><div class="line number126 index125 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py color1">self</code><code class="py plain">.makeWritable(directory, "")</code></div><div class="line number127 index126 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">shutil.rmtree(directory,</code><code class="py color1">True</code><code class="py plain">)</code></div><div class="line number128 index127 alt1">&nbsp;</div><div class="line number129 index128 alt2"><code class="py plain">test </code><code class="py keyword">=</code> <code class="py plain">ClamAvDatabase()</code></div></div></td></tr></tbody></table></div></div>
</div> 
<footer class="entry-meta">
This entry was posted in <a href="http://tomsonsec.com/index.php/category/clamav/" rel="category tag">ClamAV</a>, <a href="http://tomsonsec.com/index.php/category/programming/" rel="category tag">programming</a> and tagged <a href="http://tomsonsec.com/index.php/tag/clamav/" rel="tag">ClamAV</a>, <a href="http://tomsonsec.com/index.php/tag/database-download/" rel="tag">Database download</a>, <a href="http://tomsonsec.com/index.php/tag/python/" rel="tag">python</a>, <a href="http://tomsonsec.com/index.php/tag/security/" rel="tag">security</a> on <a href="http://tomsonsec.com/index.php/clamav-database-downloader/" title="8:37 am" rel="bookmark"><time class="entry-date" datetime="2013-11-12T08:37:30+00:00">November 12, 2013</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="http://tomsonsec.com/index.php/author/tomasuh/" title="View all posts by Tomasuh" rel="author">Tomasuh</a></span></span>. </footer> 
</article> 
<nav class="nav-single">
<h3 class="assistive-text">Post navigation</h3>
<span class="nav-previous"></span>
<span class="nav-next"><a href="http://tomsonsec.com/index.php/concept-anti-virus-in-python/" rel="next">Concept anti-virus in python <span class="meta-nav">→</span></a></span>
</nav> 
<div id="comments" class="comments-area">
<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://tomsonsec.com/index.php/clamav-database-downloader/#respond" style="display:none;">Cancel reply</a></small></h3>
<form action="http://tomsonsec.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p> <p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" size="30" aria-required="true" type="text"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" size="30" aria-describedby="email-notes" aria-required="true" type="text"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" size="30" type="text"></p>
<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-describedby="form-allowed-tags" aria-required="true"></textarea></p> <p class="form-allowed-tags" id="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes: <code>&lt;a
 href="" title=""&gt; &lt;abbr title=""&gt; &lt;acronym title=""&gt; 
&lt;b&gt; &lt;blockquote cite=""&gt; &lt;cite&gt; &lt;code&gt; &lt;del 
datetime=""&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=""&gt; &lt;strike&gt; 
&lt;strong&gt; </code></p> <p class="form-submit">
<input name="submit" id="submit" class="submit" value="Post Comment" type="submit">
<input name="comment_post_ID" value="38" id="comment_post_ID" type="hidden">
<input name="comment_parent" id="comment_parent" value="0" type="hidden">
</p>
<p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" value="1a7d528f65" type="hidden"></p><p style="display: none;"></p> <input id="ak_js" name="ak_js" value="1419606325687" type="hidden"></form>
</div> 
</div> 
</div> 
</div> 
</div> 
<footer id="colophon" role="contentinfo">
<div class="site-info">
<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
</div> 
</footer> 
</div> 
 
<script data-rocketoptimized="true" type="text/rocketscript">SyntaxHighlighter.autoloader('applescript			http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushAppleScript.js','actionscript3 as3		http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushAS3.js','bash shell				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushBash.js','coldfusion cf			http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushColdFusion.js','cpp c					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushCpp.js','c# c-sharp csharp		http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushCSharp.js','css					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushCss.js','delphi pascal pas		http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushDelphi.js','diff patch			    http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushDiff.js','erl erlang				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushErlang.js','groovy					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushGroovy.js','java					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushJava.js','jfx javafx				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushJavaFX.js','js jscript javascript	http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushJScript.js','perl pl				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPerl.js','php					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPhp.js','text plain				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPlain.js','powershell ps          http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPowerShell.js','py python				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPython.js','ruby rails ror rb		http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushRuby.js','sass scss              http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushSass.js','scala					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushScala.js','sql					http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushSql.js','vb vbnet				http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushVb.js','xml xhtml xslt html	http://tomsonsec.com/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushXml.js');SyntaxHighlighter.defaults['toolbar']=false;SyntaxHighlighter.defaults['tab-size']=4;SyntaxHighlighter.all();</script>
 
<script data-rocketoptimized="true" type="text/rocketscript">function showhide_toggle(a,b,c,d){var e=jQuery("#"+a+"-link-"+b),f=jQuery("#"+a+"-content-"+b);a=jQuery("#"+a+"-toggle-"+b);e.toggleClass("sh-show sh-hide");f.toggleClass("sh-show sh-hide").toggle();a.text()===c?a.text(d):a.text(c)};</script>
<script data-rocketoptimized="true" type="text/rocketscript">//<![CDATA[
var ak_js=document.getElementById("ak_js");if(!ak_js){ak_js=document.createElement('input');ak_js.setAttribute('id','ak_js');ak_js.setAttribute('name','ak_js');ak_js.setAttribute('type','hidden');}
else{ak_js.parentNode.removeChild(ak_js);}
ak_js.setAttribute('value',(new Date()).getTime());var commentForm=document.getElementById('commentform');if(commentForm){commentForm.appendChild(ak_js);}
else{var replyRowContainer=document.getElementById('replyrow');if(replyRowContainer){var children=replyRowContainer.getElementsByTagName('td');if(children.length>0){children[0].appendChild(ak_js);}}}
//]]></script>
<script data-rocketoptimized="true" type="text/rocketscript">//<![CDATA[
var addComment={moveForm:function(a,b,c,d){var e,f=this,g=f.I(a),h=f.I(c),i=f.I("cancel-comment-reply-link"),j=f.I("comment_parent"),k=f.I("comment_post_ID");if(g&&h&&i&&j){f.respondId=c,d=d||!1,f.I("wp-temp-form-div")||(e=document.createElement("div"),e.id="wp-temp-form-div",e.style.display="none",h.parentNode.insertBefore(e,h)),g.parentNode.insertBefore(h,g.nextSibling),k&&d&&(k.value=d),j.value=b,i.style.display="",i.onclick=function(){var a=addComment,b=a.I("wp-temp-form-div"),c=a.I(a.respondId);if(b&&c)return a.I("comment_parent").value="0",b.parentNode.insertBefore(c,b),b.parentNode.removeChild(b),this.style.display="none",this.onclick=null,!1};try{f.I("comment").focus()}catch(l){}return!1}},I:function(a){return document.getElementById(a)}};
//]]></script>
<script data-rocketoptimized="true" type="text/rocketscript">//<![CDATA[
(function(){var nav=document.getElementById('site-navigation'),button,menu;if(!nav)
return;button=nav.getElementsByTagName('h3')[0];menu=nav.getElementsByTagName('ul')[0];if(!button)
return;if(!menu||!menu.childNodes.length){button.style.display='none';return;}
button.onclick=function(){if(-1==menu.className.indexOf('nav-menu'))
menu.className='nav-menu';if(-1!=button.className.indexOf('toggled-on')){button.className=button.className.replace(' toggled-on','');menu.className=menu.className.replace(' toggled-on','');}else{button.className+=' toggled-on';menu.className+=' toggled-on';}};})();
//]]></script>

</body></html>